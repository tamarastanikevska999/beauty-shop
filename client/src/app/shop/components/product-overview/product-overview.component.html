<div class="product-detail container" *ngIf="product">
  <div class="product-image">
    <img [src]="product?.pictureUrl" alt="{{ product.name }}">
  </div>

  <div class="product-details">
    <h2 class="product-name">{{ product.name }}</h2>
    <p class="product-description">{{ product.description }}</p>
    <p class="product-price">{{ product.price | currency: 'EUR' }}</p>

    <div class="product-rating">
      <span *ngFor="let _ of  [1, 2, 3, 4, 5]" class="star" (click)="rateProduct(_)">
        &#9733;
      </span>
      <span class="rating-value">Rating: {{ averageRating || product.rating }}</span>
    </div>
  </div>
</div>

<div class="comment-table container">
  <h3>Customer Reviews</h3>
  <table  *ngIf="product && product.comments.length >0 " mat-table [dataSource]="product.comments" class="mat-elevation-z8">

    <!-- User Column -->
    <ng-container matColumnDef="user">
      <th mat-header-cell *matHeaderCellDef>User</th>
      <td mat-cell *matCellDef="let comment">{{ comment.user }}</td>
    </ng-container>

    <!-- Text Column -->
    <ng-container matColumnDef="text">
      <th mat-header-cell *matHeaderCellDef>Text</th>
      <td mat-cell *matCellDef="let comment">{{ comment.text }}</td>
    </ng-container>

    <!-- Rating Column -->
    <ng-container matColumnDef="rating">
      <th mat-header-cell *matHeaderCellDef>Rating</th>
      <td mat-cell *matCellDef="let comment">
        <span *ngFor="let _ of getRatingArray(comment.rating)" class="star-filled">
          &#9733;
        </span>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="['user', 'text', 'rating']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['user', 'text', 'rating'];"></tr>
  </table>

  <textarea [(ngModel)]="newComment" placeholder="Add your comment" class="comment-input"></textarea>
  <button mat-button (click)="addComment()">Add Comment</button>
</div>
